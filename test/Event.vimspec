Describe Event
	Before
		let Item = g:MS.Item
	End

	Before all
		%delete
		call append(0, [
			\ 'aaaaaaa',
			\ 'bbbbbbb',
			\ 'ccccccc',
			\ 'ddddddd',
			\ 'eeeeeee',
			\ ])
		$delete
		unlet! multiselector
	End

	Context .set(expr)
		It sets a autocmd task for the Event
			let multiselector = g:MS.Multiselector()
			let g:count = 0
			call multiselector.event.BufLeave.set('let g:count += 1')
			doautocmd <nomodeline> multiselect-events BufLeave
			Assert Equals(g:count, 1)

			let g:eventname = ''
			call multiselector.event.BufLeave.set({_ -> execute('let g:count += 1')})
			call multiselector.event.BufLeave.set({event -> execute('let g:eventname = event')})
			doautocmd <nomodeline> multiselect-events BufLeave
			Assert Equals(g:count, 3)
			Assert Equals(g:eventname, 'BufLeave')
			unlet! g:count g:eventname
			call filter(multiselector, 0)
		End
	End

	Context .unset(id)
		It removes a autocmd
			let multiselector = g:MS.Multiselector()
			let n = len(multiselector.event.BufLeave._orderlist)

			let id = multiselector.event.BufLeave.set('echo ""')
			Assert Equals(len(multiselector.event.BufLeave._orderlist), n + 1)

			call multiselector.event.BufLeave.unset(id)
			Assert Equals(len(multiselector.event.BufLeave._orderlist), n)
			call filter(multiselector, 0)
		End
	End

	Context .on()/.off()
		It turns on/off initialize process
			let multiselector = g:MS.Multiselector()
			call multiselector.extend([
				\ Item([0, 1, 1, 0], [0, 1, 1, 0], 'v'),
				\ ])

			Assert True(multiselector.event.BufLeave.isactive())
			doautocmd <nomodeline> multiselect-events BufLeave
			Assert True(empty(multiselector.itemlist))

			call multiselector.extend([
				\ Item([0, 1, 1, 0], [0, 1, 1, 0], 'v'),
				\ ])
			call multiselector.event.BufLeave.off()
			Assert False(multiselector.event.BufLeave.isactive())
			doautocmd <nomodeline> multiselect-events BufLeave
			Assert False(empty(multiselector.itemlist))

			call multiselector.event.BufLeave.on()
			Assert True(multiselector.event.BufLeave.isactive())
			doautocmd <nomodeline> multiselect-events BufLeave
			Assert True(empty(multiselector.itemlist))



			let multiselector = g:MS.Multiselector()
			call multiselector.extend([
				\ Item([0, 1, 1, 0], [0, 1, 1, 0], 'v'),
				\ ])

			Assert True(multiselector.event.TabLeave.isactive())
			doautocmd <nomodeline> multiselect-events TabLeave
			Assert True(empty(multiselector.itemlist))

			call multiselector.extend([
				\ Item([0, 1, 1, 0], [0, 1, 1, 0], 'v'),
				\ ])
			call multiselector.event.TabLeave.off()
			Assert False(multiselector.event.TabLeave.isactive())
			doautocmd <nomodeline> multiselect-events TabLeave
			Assert False(empty(multiselector.itemlist))

			call multiselector.event.TabLeave.on()
			Assert True(multiselector.event.TabLeave.isactive())
			doautocmd <nomodeline> multiselect-events TabLeave
			Assert True(empty(multiselector.itemlist))



			let multiselector = g:MS.Multiselector()
			call multiselector.extend([
				\ Item([0, 1, 1, 0], [0, 1, 1, 0], 'v'),
				\ ])

			Assert True(multiselector.event.CmdwinLeave.isactive())
			doautocmd <nomodeline> multiselect-events CmdwinLeave
			Assert True(empty(multiselector.itemlist))

			call multiselector.extend([
				\ Item([0, 1, 1, 0], [0, 1, 1, 0], 'v'),
				\ ])
			call multiselector.event.CmdwinLeave.off()
			Assert False(multiselector.event.CmdwinLeave.isactive())
			doautocmd <nomodeline> multiselect-events CmdwinLeave
			Assert False(empty(multiselector.itemlist))

			call multiselector.event.CmdwinLeave.on()
			Assert True(multiselector.event.CmdwinLeave.isactive())
			doautocmd <nomodeline> multiselect-events CmdwinLeave
			Assert True(empty(multiselector.itemlist))
			call filter(multiselector, 0)
		End

		It turns on/off auto-uncheckall process
			let multiselector = g:MS.Multiselector()
			call multiselector.extend([
				\ Item([0, 1, 1, 0], [0, 1, 1, 0], 'v'),
				\ ])

			Assert True(multiselector.event.TextChanged.isactive())
			doautocmd <nomodeline> multiselect-events TextChanged
			Assert True(empty(multiselector.itemlist))

			call multiselector.extend([
				\ Item([0, 1, 1, 0], [0, 1, 1, 0], 'v'),
				\ ])
			call multiselector.event.TextChanged.off()
			Assert False(multiselector.event.TextChanged.isactive())
			doautocmd <nomodeline> multiselect-events TextChanged
			Assert False(empty(multiselector.itemlist))

			call multiselector.event.TextChanged.on()
			Assert True(multiselector.event.TextChanged.isactive())
			doautocmd <nomodeline> multiselect-events TextChanged
			Assert True(empty(multiselector.itemlist))



			let multiselector = g:MS.Multiselector()
			call multiselector.extend([
				\ Item([0, 1, 1, 0], [0, 1, 1, 0], 'v'),
				\ ])

			Assert True(multiselector.event.InsertEnter.isactive())
			doautocmd <nomodeline> multiselect-events InsertEnter
			Assert True(empty(multiselector.itemlist))

			call multiselector.extend([
				\ Item([0, 1, 1, 0], [0, 1, 1, 0], 'v'),
				\ ])
			call multiselector.event.InsertEnter.off()
			Assert False(multiselector.event.InsertEnter.isactive())
			doautocmd <nomodeline> multiselect-events InsertEnter
			Assert False(empty(multiselector.itemlist))

			call multiselector.event.InsertEnter.on()
			Assert True(multiselector.event.InsertEnter.isactive())
			doautocmd <nomodeline> multiselect-events InsertEnter
			Assert True(empty(multiselector.itemlist))
			call filter(multiselector, 0)
		End

		It turns on/off auto-highlight process for a new window
			let multiselector = g:MS.Multiselector()
			call multiselector.extend([
				\ Item([0, 1, 1, 0], [0, 1, 1, 0], 'v'),
				\ ])
			call multiselector.itemlist[0].quench()

			Assert True(multiselector.event.WinNew.isactive())
			Assert False(multiselector.itemlist[0]._histatus(win_getid()))
			doautocmd <nomodeline> multiselect-events WinNew
			Assert True(multiselector.itemlist[0]._histatus(win_getid()))
			call filter(multiselector, 0)
		End
	End

	Context .skip()
		It sets a count to ignore autocmd events
			let multiselector = g:MS.Multiselector()
			call multiselector.extend([
				\ Item([0, 1, 1, 0], [0, 1, 1, 0], 'v'),
				\ ])
			Assert True(multiselector.event.BufLeave.isactive())
			call multiselector.event.BufLeave.skip(1)
			Assert False(multiselector.event.BufLeave.isactive())
			Assert False(empty(multiselector.itemlist))
			doautocmd <nomodeline> multiselect-events BufLeave
			Assert True(multiselector.event.BufLeave.isactive())
			Assert False(empty(multiselector.itemlist))
			doautocmd <nomodeline> multiselect-events BufLeave
			Assert True(multiselector.event.BufLeave.isactive())
			Assert True(empty(multiselector.itemlist))



			let multiselector = g:MS.Multiselector()
			call multiselector.extend([
				\ Item([0, 1, 1, 0], [0, 1, 1, 0], 'v'),
				\ ])
			Assert True(multiselector.event.BufLeave.isactive())
			call multiselector.event.BufLeave.skip(2)
			Assert False(multiselector.event.BufLeave.isactive())
			Assert False(empty(multiselector.itemlist))
			doautocmd <nomodeline> multiselect-events BufLeave
			Assert False(multiselector.event.BufLeave.isactive())
			Assert False(empty(multiselector.itemlist))
			doautocmd <nomodeline> multiselect-events BufLeave
			Assert True(multiselector.event.BufLeave.isactive())
			Assert False(empty(multiselector.itemlist))
			doautocmd <nomodeline> multiselect-events BufLeave
			Assert True(multiselector.event.BufLeave.isactive())
			Assert True(empty(multiselector.itemlist))



			let multiselector = g:MS.Multiselector()
			call multiselector.extend([
				\ Item([0, 1, 1, 0], [0, 1, 1, 0], 'v'),
				\ ])
			Assert True(multiselector.event.BufLeave.isactive())
			call multiselector.event.BufLeave.skip(0)
			Assert True(multiselector.event.BufLeave.isactive())
			doautocmd <nomodeline> multiselect-events BufLeave
			Assert True(multiselector.event.BufLeave.isactive())
			Assert True(empty(multiselector.itemlist))
			call filter(multiselector, 0)
		End
	End

	Context Init event
		It is triggered when a Multiselector instance is produced
			let g:count = 0
			augroup test
				autocmd!
				autocmd User TestInit let g:count += 1
			augroup End

			Assert Equals(g:count, 0)
			let multiselector = g:MS.Multiselector({'eventinit': 'TestInit'})
			Assert Equals(g:count, 1)

			augroup test
				autocmd!
			augroup End
			unlet! g:count
			call filter(multiselector, 0)
		End

		It is triggered when BufLeave event is triggered
			let multiselector = g:MS.Multiselector({'eventinit': 'TestInit'})
			let g:count = 0
			augroup test
				autocmd!
				autocmd User TestInit let g:count += 1
			augroup End

			Assert Equals(g:count, 0)
			doautocmd <nomodeline> multiselect-events BufLeave
			Assert Equals(g:count, 1)

			augroup test
				autocmd!
			augroup End
			unlet! g:count
			call filter(multiselector, 0)
		End

		It is triggered when TabLeave event is triggered
			let multiselector = g:MS.Multiselector({'eventinit': 'TestInit'})
			let g:count = 0
			augroup test
				autocmd!
				autocmd User TestInit let g:count += 1
			augroup End

			Assert Equals(g:count, 0)
			doautocmd <nomodeline> multiselect-events TabLeave
			Assert Equals(g:count, 1)

			augroup test
				autocmd!
			augroup End
			unlet! g:count
			call filter(multiselector, 0)
		End

		It is triggered when CmdwinLeave event is triggered
			let multiselector = g:MS.Multiselector({'eventinit': 'TestInit'})
			let g:count = 0
			augroup test
				autocmd!
				autocmd User TestInit let g:count += 1
			augroup End

			Assert Equals(g:count, 0)
			doautocmd <nomodeline> multiselect-events CmdwinLeave
			Assert Equals(g:count, 1)

			augroup test
				autocmd!
			augroup End
			unlet! g:count
			call filter(multiselector, 0)
		End
	End

	Context CheckPost event
		It is triggered when Multiselect.check() method is called
			let multiselector = g:MS.Multiselector({'eventcheckpost': 'TestCheckPost'})
			let g:count = 0
			augroup test
				autocmd!
				autocmd User TestCheckPost let g:count += 1
			augroup End

			Assert Equals(g:count, 0)
			call multiselector.check([0, 1, 1, 0], [0, 1, 1, 0])
			Assert Equals(g:count, 1)

			augroup test
				autocmd!
			augroup End
			unlet! g:count
			call filter(multiselector, 0)
		End

		It is triggered when Multiselect.extend() method is called
			let multiselector = g:MS.Multiselector({'eventcheckpost': 'TestCheckPost'})
			let item = g:MS.Item([0, 1, 1, 0], [0, 1, 1, 0])
			let g:count = 0
			augroup test
				autocmd!
				autocmd User TestCheckPost let g:count += 1
			augroup End

			Assert Equals(g:count, 0)
			call multiselector.extend([item])
			Assert Equals(g:count, 1)

			augroup test
				autocmd!
			augroup End
			unlet! g:count
			call filter(multiselector, 0)
		End

		It is triggered when Multiselect.add() method is called
			let multiselector = g:MS.Multiselector({'eventcheckpost': 'TestCheckPost'})
			let item = g:MS.Item([0, 1, 1, 0], [0, 1, 1, 0])
			let g:count = 0
			augroup test
				autocmd!
				autocmd User TestCheckPost let g:count += 1
			augroup End

			Assert Equals(g:count, 0)
			call multiselector.add(item)
			Assert Equals(g:count, 1)

			augroup test
				autocmd!
			augroup End
			unlet! g:count
			call filter(multiselector, 0)
		End
	End

	Context UncheckPost event
		It is triggered when Multiselect.uncheck() method is called
			let multiselector = g:MS.Multiselector({'eventuncheckpost': 'TestUncheckPost'})
			let g:count = 0
			augroup test
				autocmd!
				autocmd User TestUncheckPost let g:count += 1
			augroup End

			Assert Equals(g:count, 0)
			call multiselector.check([0, 1, 1, 0], [0, 1, 1, 0])
			Assert Equals(g:count, 0)
			call multiselector.uncheck([0, 1, 1, 0])
			Assert Equals(g:count, 1)

			augroup test
				autocmd!
			augroup End
			unlet! g:count
			call filter(multiselector, 0)
		End

		It is triggered when Multiselect.emit() method is called
			let multiselector = g:MS.Multiselector({'eventuncheckpost': 'TestUncheckPost'})
			let g:count = 0
			augroup test
				autocmd!
				autocmd User TestUncheckPost let g:count += 1
			augroup End

			Assert Equals(g:count, 0)
			call multiselector.check([0, 1, 1, 0], [0, 1, 1, 0])
			Assert Equals(g:count, 0)
			call multiselector.emit()
			Assert Equals(g:count, 1)

			augroup test
				autocmd!
			augroup End
			unlet! g:count
			call filter(multiselector, 0)
		End

		It is triggered when Multiselect.remove() method is called
			let multiselector = g:MS.Multiselector({'eventuncheckpost': 'TestUncheckPost'})
			let g:count = 0
			augroup test
				autocmd!
				autocmd User TestUncheckPost let g:count += 1
			augroup End

			Assert Equals(g:count, 0)
			call multiselector.check([0, 1, 1, 0], [0, 1, 1, 0])
			Assert Equals(g:count, 0)
			call multiselector.remove(0)
			Assert Equals(g:count, 1)

			augroup test
				autocmd!
			augroup End
			unlet! g:count
			call filter(multiselector, 0)
		End
	End
End
" vim:set noet ts=4 sw=4 sts=-1:
